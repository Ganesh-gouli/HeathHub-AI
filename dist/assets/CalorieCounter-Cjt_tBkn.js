import{u as E,r as i,j as e,I as S,f as A,i as V,c as L,k as W}from"./index-CXTOnbpn.js";import{s as G}from"./emailService-GrK2Hnyv.js";import{L as H}from"./LoadingSpinner-BDg57fWP.js";const q=()=>{const{addFoodItems:M,navigateTo:R,user:m}=E(),[u,g]=i.useState("upload"),[n,v]=i.useState(null),[b,N]=i.useState(null),[w,C]=i.useState(""),[y,x]=i.useState(!1),[I,l]=i.useState(""),[h,c]=i.useState([]),[d,p]=i.useState(null),z=a=>{var s;const r=(s=a.target.files)==null?void 0:s[0];r&&(v(r),N(URL.createObjectURL(r)),g("upload"),l(""),c([]),p(null))},O=async()=>{if(!n){l("Please upload a photo of your meal.");return}x(!0),l("");try{const a=await A(n),r=await V(a,n.type,w);c(r.map(s=>({...s,id:Math.random().toString(36).substr(2,9)}))),g("confirm")}catch(a){l(`Failed to identify food. ${L(a)} Please try with a clearer photo.`),console.error(a)}finally{x(!1)}},T=async()=>{if(!n||h.length===0){l("No food items to analyze.");return}x(!0),l("");try{const a=await A(n),r=await W(h,a,n.type);p(r),g("result")}catch(a){l(`Failed to get nutritional info. ${L(a)}`),console.error(a)}finally{x(!1)}},B=async()=>{if(d){const a=d.foodItems.map(r=>({name:r.name,calories:r.calories}));if(M(a,"counter"),m&&m.email)try{const r=new Date().toISOString().split("T")[0],s=a.reduce((f,t)=>f+t.calories,0);await G(m.email,{intake:s,burned:0,net:s,date:r,foods:a}),console.log("Meal logged and report sent.")}catch(r){console.error("Failed to send auto-report:",r)}R("TODAYS_GOAL")}},F=()=>{g("upload"),v(null),N(null),l(""),c([]),p(null),C("")},D=()=>e.jsxs("form",{onSubmit:a=>{a.preventDefault(),O()},className:"space-y-8 animate-fade-in",children:[e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2 uppercase tracking-wider",children:"Food Photo"}),e.jsxs("label",{htmlFor:"file-upload",className:`relative flex flex-col items-center justify-center w-full h-64 border-2 border-dashed rounded-2xl cursor-pointer transition-all duration-300 ${n?"border-orange-500 bg-orange-50 dark:bg-orange-900/10":"border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700/30 hover:bg-gray-100 dark:hover:bg-gray-700 hover:border-orange-400"}`,children:[e.jsx("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:b?e.jsx("img",{src:b,alt:"Meal preview",className:"h-48 w-auto object-contain rounded-lg shadow-sm"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-white dark:bg-gray-800 rounded-full flex items-center justify-center shadow-sm mb-4 group-hover:scale-110 transition-transform duration-300",children:e.jsxs("svg",{className:"w-8 h-8 text-gray-400 dark:text-gray-500 group-hover:text-orange-500 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white group-hover:text-orange-600 dark:group-hover:text-orange-400",children:"Tap to upload"})," meal photo"]})]})}),e.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",onChange:z,accept:"image/*"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2",children:"Add Context (Optional)"}),e.jsx("textarea",{value:w,onChange:a=>C(a.target.value),placeholder:"e.g., 3 chapatis, cooked with ghee, homemade curry",rows:3,className:"block w-full px-4 py-3 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all resize-none text-gray-900 dark:text-white"})]}),e.jsx("button",{type:"submit",disabled:!n||y,className:"w-full py-4 px-6 bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold text-lg rounded-2xl shadow-lg shadow-orange-500/30 hover:shadow-xl hover:-translate-y-1 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none disabled:transform-none transition-all duration-200",children:y?"Analyzing Image...":"Identify Food Items"})]}),P=()=>{const a=(t,o,j)=>{c($=>$.map(k=>k.id===t?{...k,[o]:j}:k))},r=()=>{c(t=>[...t,{id:Math.random().toString(36).substr(2,9),name:"",weight:0,cookingMethod:"Unknown"}])},s=t=>{c(o=>o.filter(j=>j.id!==t))},f=["Fried","Grilled","Boiled/Steamed","Raw","Baked","Curry/Gravy","Roasted","Unknown"];return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:b,alt:"Meal",className:"rounded-2xl shadow-md max-h-64 object-cover"})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-1 rounded-2xl border border-gray-200 dark:border-gray-700 overflow-x-auto",children:[e.jsxs("div",{className:"min-w-[500px] grid grid-cols-12 gap-2 px-4 py-2 text-xs font-bold text-gray-400 uppercase tracking-wider",children:[e.jsx("div",{className:"col-span-5",children:"Item Name"}),e.jsx("div",{className:"col-span-3",children:"Cooking Method"}),e.jsx("div",{className:"col-span-3",children:"Weight (g)"}),e.jsx("div",{className:"col-span-1"})]}),e.jsxs("div",{className:"space-y-1 min-w-[500px]",children:[h.map(t=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center bg-white dark:bg-gray-700/30 p-3 rounded-xl border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"col-span-5",children:e.jsx("input",{type:"text",value:t.name,onChange:o=>a(t.id,"name",o.target.value),className:"w-full bg-transparent font-medium text-gray-800 dark:text-white focus:outline-none border-b border-transparent focus:border-orange-400 transition-colors"})}),e.jsx("div",{className:"col-span-3",children:e.jsx("select",{value:t.cookingMethod,onChange:o=>a(t.id,"cookingMethod",o.target.value),className:"w-full bg-transparent text-sm text-gray-600 dark:text-gray-300 focus:outline-none cursor-pointer border-b border-transparent focus:border-orange-400",children:f.map(o=>e.jsx("option",{value:o,children:o},o))})}),e.jsx("div",{className:"col-span-3",children:e.jsx("input",{type:"number",value:t.weight,onChange:o=>a(t.id,"weight",parseFloat(o.target.value)||0),className:"w-full bg-transparent font-medium text-gray-800 dark:text-white focus:outline-none border-b border-transparent focus:border-orange-400 transition-colors"})}),e.jsx("div",{className:"col-span-1 flex justify-end",children:e.jsx("button",{onClick:()=>s(t.id),className:"text-red-400 hover:text-red-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})})]},t.id)),h.length===0&&e.jsx("p",{className:"text-center text-sm text-gray-500 dark:text-gray-400 py-4",children:"No items identified. Please add manually."})]})]}),e.jsx("button",{onClick:r,className:"w-full py-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl text-gray-500 dark:text-gray-400 font-medium hover:border-orange-400 hover:text-orange-500 transition-colors",children:"+ Add Another Item"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("button",{onClick:F,className:"py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-bold rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"Back"}),e.jsx("button",{onClick:T,className:"py-3 px-4 bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold rounded-xl shadow-lg shadow-orange-500/30 hover:shadow-xl hover:-translate-y-0.5 transition-all",children:"Calculate Calories"})]})]})},U=()=>{if(!d)return null;const a=d.foodItems.reduce((r,s)=>r+s.calories,0);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"inline-block p-4 rounded-full bg-orange-50 dark:bg-orange-900/20 mb-2",children:[e.jsx("div",{className:"text-4xl font-black text-orange-600 dark:text-orange-400",children:a.toFixed(0)}),e.jsx("div",{className:"text-xs font-bold text-orange-400 uppercase tracking-widest",children:"Total Calories"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:d.foodItems.map((r,s)=>e.jsxs("div",{className:"p-4 border-b border-gray-100 dark:border-gray-700 last:border-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-900 dark:text-white",children:r.name}),e.jsxs("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${r.source==="USDA"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300"}`,children:[r.source," Verified"]})]}),e.jsxs("span",{className:"font-bold text-orange-600 dark:text-orange-400",children:[r.calories.toFixed(0)," kcal"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-center text-xs text-gray-500 dark:text-gray-400 mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-700 dark:text-gray-300",children:[r.protein.toFixed(1),"g"]}),e.jsx("div",{children:"Protein"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-700 dark:text-gray-300",children:[r.carbs.toFixed(1),"g"]}),e.jsx("div",{children:"Carbs"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-700 dark:text-gray-300",children:[r.fat.toFixed(1),"g"]}),e.jsx("div",{children:"Fat"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-700 dark:text-gray-300",children:[r.fiber.toFixed(1),"g"]}),e.jsx("div",{children:"Fiber"})]})]}),r.healthVerdict&&e.jsxs("div",{className:"mt-2 text-xs bg-gray-50 dark:bg-gray-700/50 p-2 rounded-lg border-l-4 border-orange-400 dark:border-orange-500 text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-bold text-orange-500 dark:text-orange-400 mr-1",children:"Health Insight:"}),r.healthVerdict]})]},s))}),e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/30 p-3 rounded-xl text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"AI Confidence Score"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-24 h-2 bg-gray-200 dark:bg-gray-600 rounded-full mr-3 overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${d.accuracy>80?"bg-green-500":d.accuracy>50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${d.accuracy}%`}})}),e.jsxs("span",{className:"font-bold text-gray-700 dark:text-gray-200",children:[d.accuracy,"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2",children:[e.jsx("button",{onClick:F,className:"py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-bold rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"Discard"}),e.jsx("button",{onClick:B,className:"py-3 px-4 bg-green-600 text-white font-bold rounded-xl shadow-lg hover:bg-green-700 transition-colors",children:"Log to Journal"})]})]})};return y?e.jsx("div",{className:"max-w-4xl mx-auto p-6 bg-white dark:bg-gray-800 rounded-3xl shadow-xl border border-gray-100 dark:border-gray-700 min-h-[400px] flex items-center justify-center",children:e.jsx(H,{message:"Analyzing your food..."})}):e.jsxs("div",{className:"max-w-3xl mx-auto bg-white dark:bg-gray-800 p-6 md:p-10 rounded-3xl shadow-xl border border-gray-100 dark:border-gray-700 animate-fade-in-up",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 mb-4",children:S.flame}),e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 dark:text-white tracking-tight",children:"AI Calorie Counter"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2",children:"Snap a photo, and let AI calculate your nutrition."})]}),I&&e.jsxs("div",{className:"mb-6 flex items-start p-4 bg-red-50 dark:bg-red-900/30 rounded-xl border border-red-100 dark:border-red-800",children:[e.jsx("div",{className:"flex-shrink-0 text-red-500 dark:text-red-400",children:S.warning}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:I})})]}),u==="upload"&&D(),u==="confirm"&&P(),u==="result"&&U()]})};export{q as default};
